---
title: "Summary of EPI1 Scenarios"
author: "Pragati Prasad"
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## {.tabset}


### Scenario Key
HP01 - BASE: R0 1.4 and “2009-like” severity   
HP02 - VX1: “Early”: Vaccine available 100 days after September 1    
HP03 - VX2: “Normal”: Vaccine available 150 days after September 1    
HP04 - SC1: Weekly Symptomatic Prevalence > 1% trigger, early (VX1) vaccine availability reopening   
HP05 - SC2: Close on October 28, early (VX1) vaccine availability reopening    
HP06 - SC3: Weekly Symptomatic Prevalence > 1% trigger, normal (VX2) vaccine availability reopening   
HP07 - SC4: Close on October 28, normal (VX2) vaccine availability reopening    
HP08 - AV: Antivirals   
HP09 - VX1 + SC1 + AV  
HP10 - VX1 + SC2 + AV  
HP11 - VX2 + SC3 + AV  
HP12 - VX2 + SC4 + AV  

```{r setup_1, warning=FALSE, message = FALSE}

library(ggsci)
library(reshape)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(egg)
library(plyr) 
library(tidyr)
library(knitr)
library(kableExtra)
library(scales)

path <- "../model-forecasts/"

team.folder <- c("Columbia/COL/EPI1/", "Northeastern/EPI1/", "UTAustin/", "UVirginia/", "Imperial/", "Columbia/COL2/EPI1/")
team.abbrev <- c("COL", "NEU", "UTA", "UVA", "IMP", "COL2")
file.types <- c("SymIllness", "Hosp", "Deaths", "AntiviralTX")

file.type <- file.types[1]
scn = "HP01_"
read_ill <- function(scn){
  
  cols <- c("sm.mean")

  s <- read.csv(paste0(path,team.folder[1],scn,file.type,"_",team.abbrev[1],".csv"))
  symillness <- data.frame(c(s[which(s$Agegroup == "Overall" &
                                       s$Bin_cml %in% cols),],
                             `team` = team.abbrev[1]))
  
  for(i in 2:6){
    
    if(i == 4){
      scn = gsub("HP", "HP_", scn)
    }
    if(i == 5){
      scn = gsub("_", "", scn)
      if(file.type == "Deaths"){
        file.type = "Death"
      }
    }
    if(i == 6){
      scn = paste0(scn, "_")
      if(file.type == "Death"){
        file.type = "Deaths"
      }
    }
    
    f =  paste0(path,team.folder[i],scn,file.type,"_",team.abbrev[i],".csv")
    if(i == 5){
      f =  paste0(path,team.folder[i],scn,file.type,team.abbrev[i],".csv")
    }

    if(file.exists(f)){
      s <- read.csv(f)
      if(ncol(s) > 58){
        s <- s[-1]
      }
      symillness <- rbind.fill(symillness, 
                               data.frame(c(s[which(s$Agegroup == "Overall" & 
                                                      s$Bin_cml %in% cols),],`team` = team.abbrev[i])))
    }
    
  }
  symillness$Peak.Magnitude[which(is.na(symillness$Peak.Magnitude))] <-
    symillness$PeakMagnitude[which(is.na(symillness$Peak.Magnitude))]
  
  symillness$Bin[which(symillness$Bin_cml == "Peak")] <- "sm.peak"
  cml <- symillness[c("Cml", "team", "Bin", "Peak.Magnitude")]
  
  return(cml)
}

tab_HP01 <- read_ill(scn = "HP01_")

# Cumulative % Ill
cml <- data.frame(`HP01` = tab_HP01$Cml)

# Peak Magnitude
peak <- data.frame(`HP01` = tab_HP01$Peak.Magnitude)

rownames(cml) <- tab_HP01$team
rownames(peak) <- tab_HP01$team

scenario <- "HP02_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP02 <- long$Cml

# Peak Magnitude
peak$HP02 = long$Peak.Magnitude

scenario <- "HP03_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP03 <- long$Cml

# Peak Magnitude
peak$HP03 = long$Peak.Magnitude

scenario <- "HP04_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP04 <- long$Cml

# Peak Magnitude
peak$HP04 = long$Peak.Magnitude

scenario <- "HP05_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP05 <- long$Cml

# Peak Magnitude
peak$HP05 = long$Peak.Magnitude

scenario <- "HP06_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP06 <- long$Cml

# Peak Magnitude
peak$HP06 = long$Peak.Magnitude

scenario <- "HP07_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP07 <- long$Cml

# Peak Magnitude
peak$HP07 = long$Peak.Magnitude

scenario <- "HP08_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP08 <- long$Cml

# Peak Magnitude
peak$HP08 = long$Peak.Magnitude

scenario <- "HP09_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)

# Cumulative % Ill
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude
```


### Cumulative % Ill

```{r ill_1, warning=FALSE, message = FALSE}

knitr::kable(cml, digits = 2, caption = "Cumulative % Ill") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```


### Peak % Ill

```{r ill_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak Magnitude Ill") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative Hosps
```{r hosp_1, warning=FALSE, message = FALSE}
file.type = file.types[2]
tab_HP01 <- read_ill(scn = "HP01_")

# Cumulative Hosps
cml <- data.frame(`HP01` = tab_HP01$Cml)

# Peak Magnitude
peak <- data.frame(`HP01` = tab_HP01$Peak.Magnitude)

rownames(cml) <- tab_HP01$team
rownames(peak) <- tab_HP01$team

scenario <- "HP02_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP02 <- long$Cml

# Peak Magnitude
peak$HP02 = long$Peak.Magnitude

scenario <- "HP03_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP03 <- long$Cml

# Peak Magnitude
peak$HP03 = long$Peak.Magnitude

scenario <- "HP04_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP04 <- long$Cml

# Peak Magnitude
peak$HP04 = long$Peak.Magnitude

scenario <- "HP05_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP05 <- long$Cml

# Peak Magnitude
peak$HP05 = long$Peak.Magnitude

scenario <- "HP06_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP06 <- long$Cml

# Peak Magnitude
peak$HP06 = long$Peak.Magnitude

scenario <- "HP07_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP07 <- long$Cml

# Peak Magnitude
peak$HP07 = long$Peak.Magnitude

scenario <- "HP08_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP08 <- long$Cml

# Peak Magnitude
peak$HP08 = long$Peak.Magnitude

scenario <- "HP09_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)

# Cumulative Hospitalizations per 100K
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude

knitr::kable(cml, digits = 2, caption = "Cumulative Hospitalizations per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak Hosps

```{r hosp_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak Hospitalizations per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```


### Cumulative Deaths
```{r death_1, warning=FALSE, message = FALSE}
file.type = file.types[3]
tab_HP01 <- read_ill(scn = "HP01_")

# Cumulative Hosps
cml <- data.frame(`HP01` = tab_HP01$Cml)

# Peak Magnitude
peak <- data.frame(`HP01` = tab_HP01$Peak.Magnitude)

rownames(cml) <- tab_HP01$team
rownames(peak) <- tab_HP01$team

scenario <- "HP02_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP02 <- long$Cml

# Peak Magnitude
peak$HP02 = long$Peak.Magnitude

scenario <- "HP03_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP03 <- long$Cml

# Peak Magnitude
peak$HP03 = long$Peak.Magnitude

scenario <- "HP04_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP04 <- long$Cml

# Peak Magnitude
peak$HP04 = long$Peak.Magnitude

scenario <- "HP05_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP05 <- long$Cml

# Peak Magnitude
peak$HP05 = long$Peak.Magnitude

scenario <- "HP06_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP06 <- long$Cml

# Peak Magnitude
peak$HP06 = long$Peak.Magnitude

scenario <- "HP07_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP07 <- long$Cml

# Peak Magnitude
peak$HP07 = long$Peak.Magnitude

scenario <- "HP08_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP08 <- long$Cml

# Peak Magnitude
peak$HP08 = long$Peak.Magnitude

scenario <- "HP09_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)

# Cumulative Deaths per 100K
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude

knitr::kable(cml, digits = 2, caption = "Cumulative Deaths per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak Deaths

```{r death_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak Deaths per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative % Antivirals
```{r av_1, warning=FALSE, message = FALSE}
file.type = file.types[4]
tab_HP08 <- read_ill(scn = "HP08_")

# Cumulative Hosps
cml <- data.frame(`HP08` = tab_HP08$Cml)

# Peak Magnitude
peak <- data.frame(`HP08` = tab_HP08$Peak.Magnitude)

rownames(cml) <- tab_HP08$team
rownames(peak) <- tab_HP08$team

scenario <- "HP09_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude

knitr::kable(cml, digits = 2, caption = "Cumulative % Antivirals") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak % Antivirals

```{r av_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak % Antivirals") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```