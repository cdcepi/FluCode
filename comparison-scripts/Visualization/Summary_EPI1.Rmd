---
title: "Summary of EPI1 Scenarios"
author: "Pragati Prasad"
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## {.tabset}


### Scenario Key
HP01 - BASE: R0 1.4 and “2009-like” severity   
HP02 - VX1: “Early”: Vaccine available 100 days after September 1    
HP03 - VX2: “Normal”: Vaccine available 150 days after September 1    
HP04 - SC1: Weekly Symptomatic Prevalence > 1% trigger, early (VX1) vaccine availability reopening   
HP05 - SC2: Close on October 28, early (VX1) vaccine availability reopening    
HP06 - SC3: Weekly Symptomatic Prevalence > 1% trigger, normal (VX2) vaccine availability reopening   
HP07 - SC4: Close on October 28, normal (VX2) vaccine availability reopening    
HP08 - AV: Antivirals   
HP09 - VX1 + SC1 + AV  
HP10 - VX1 + SC2 + AV  
HP11 - VX2 + SC3 + AV  
HP12 - VX2 + SC4 + AV  

```{r setup_1, warning=FALSE, message = FALSE}

library(ggsci)
library(reshape)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(egg)
library(plyr) 
library(tidyr)
library(knitr)
library(kableExtra)
library(scales)

path <- "../../model-forecasts/"

team.folder <- c("Columbia/COL/EPI1/", "Northeastern/EPI1/", "UTAustin/", "UVirginia/", "Imperial/", "Columbia/COL2/EPI1/")
team.abbrev <- c("COL", "NEU", "UTA", "UVA", "IMP", "COL2")
file.types <- c("SymIllness", "Hosp", "Deaths", "AntiviralTX")

file.type <- file.types[1]
scn = "HP01_"
read_ill <- function(scn){
  
  cols <- c("sm.mean")

  s <- read.csv(paste0(path,team.folder[1],scn,file.type,"_",team.abbrev[1],".csv"))
  symillness <- data.frame(c(s[which(s$Agegroup == "Overall" &
                                       s$Bin_cml %in% cols),],
                             `team` = team.abbrev[1]))
  
  df_sub <- select(symillness, contains("Week"))
  peak.week<- c(team.abbrev[1], colnames(df_sub)[which.max(df_sub)])
  
  for(i in 2:6){
    
    if(i == 4){
      scn = gsub("HP", "HP_", scn)
    }
    if(i == 5){
      scn = gsub("_", "", scn)
      if(file.type == "Deaths"){
        file.type = "Death"
      }
    }
    if(i == 6){
      scn = paste0(scn, "_")
      if(file.type == "Death"){
        file.type = "Deaths"
      }
    }
    
    f =  paste0(path,team.folder[i],scn,file.type,"_",team.abbrev[i],".csv")
    if(i == 5){
      f =  paste0(path,team.folder[i],scn,file.type,team.abbrev[i],".csv")
    }

    if(file.exists(f)){
      s <- read.csv(f)
      # if(ncol(s) > 58){
      #   s <- s[-1]
      # }
      u <- data.frame(c(s[which(s$Agegroup == "Overall" & 
                                  s$Bin_cml %in% cols),],`team` = team.abbrev[i]))
      symillness <- rbind.fill(symillness, u) %>% filter(Location == "US National")
      df_sub <- u %>% 
        filter(Location == "US National")%>% 
        select(contains("Week")) 
      peak.week <- rbind(peak.week, c(team.abbrev[i], colnames(df_sub)[which.max(df_sub)]))
    }
    
  }
  symillness$Peak.Magnitude[which(is.na(symillness$Peak.Magnitude))] <-
    symillness$PeakMagnitude[which(is.na(symillness$Peak.Magnitude))]
  
  symillness$Bin[which(symillness$Bin_cml == "Peak")] <- "sm.peak"
  cml <- symillness[c("Cml", "team", "Bin", "Peak.Magnitude")]
  peak.week <<- as.data.frame(peak.week)
  return(cml)
}

tab_HP01 <- read_ill(scn = "HP01_")
all.peak.weeks <- data.frame(`HP01` = as.integer(gsub("Week", "", peak.week$V2)))
rownames(all.peak.weeks) <- peak.week$V1

# Cumulative % Ill
cml <- data.frame(`HP01` = tab_HP01$Cml)

# Peak Magnitude
peak <- data.frame(`HP01` = tab_HP01$Peak.Magnitude)

rownames(cml) <- tab_HP01$team
rownames(peak) <- tab_HP01$team

scenario <- "HP02_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP02 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP02 <- long$Cml

# Peak Magnitude
peak$HP02 = long$Peak.Magnitude

scenario <- "HP03_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP03 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP03 <- long$Cml

# Peak Magnitude
peak$HP03 = long$Peak.Magnitude

scenario <- "HP04_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP04 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP04 <- long$Cml

# Peak Magnitude
peak$HP04 = long$Peak.Magnitude

scenario <- "HP05_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP05 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP05 <- long$Cml

# Peak Magnitude
peak$HP05 = long$Peak.Magnitude

scenario <- "HP06_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP06 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP06 <- long$Cml

# Peak Magnitude
peak$HP06 = long$Peak.Magnitude

scenario <- "HP07_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP07 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP07 <- long$Cml

# Peak Magnitude
peak$HP07 = long$Peak.Magnitude

scenario <- "HP08_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP08 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP08 <- long$Cml

# Peak Magnitude
peak$HP08 = long$Peak.Magnitude

scenario <- "HP09_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP09 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP10 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP11 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP12 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude
```


### Cumulative % Ill

```{r ill_1, warning=FALSE, message = FALSE}

knitr::kable(cml, digits = 2, caption = "Cumulative % Ill") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```


### Peak % Ill

```{r ill_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak Magnitude Ill") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_reduction <- data.frame(HP02 = (peak$HP01 - peak$HP02)/peak$HP01,
                             HP03 = (peak$HP01 - peak$HP03)/peak$HP01,
                             HP04 = (peak$HP01 - peak$HP04)/peak$HP01,
                             HP05 = (peak$HP01 - peak$HP05)/peak$HP01,
                             HP06 = (peak$HP01 - peak$HP06)/peak$HP01,
                             HP07 = (peak$HP01 - peak$HP07)/peak$HP01,
                             HP08 = (peak$HP01 - peak$HP08)/peak$HP01,
                             HP09 = (peak$HP01 - peak$HP09)/peak$HP01,
                             HP10 = (peak$HP01 - peak$HP10)/peak$HP01,
                             HP11 = (peak$HP01 - peak$HP11)/peak$HP01,
                             HP12 = (peak$HP01 - peak$HP12)/peak$HP01)
rownames(peak_reduction) <- rownames(peak)

knitr::kable(peak_reduction*100, digits = 2, caption = "% Reduction in Peak Magnitude Ill (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


##Peak Week 
knitr::kable(all.peak.weeks, digits = 2, caption = "Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

##Peak Delay
peak_delay <- data.frame(HP02 = -(all.peak.weeks$HP01 - all.peak.weeks$HP02),
                             HP03 = -(all.peak.weeks$HP01 - all.peak.weeks$HP03),
                             HP04 = -(all.peak.weeks$HP01 - all.peak.weeks$HP04),
                             HP05 = -(all.peak.weeks$HP01 - all.peak.weeks$HP05),
                             HP06 = -(all.peak.weeks$HP01 - all.peak.weeks$HP06),
                             HP07 = -(all.peak.weeks$HP01 - all.peak.weeks$HP07),
                             HP08 = -(all.peak.weeks$HP01 - all.peak.weeks$HP08),
                             HP09 = -(all.peak.weeks$HP01 - all.peak.weeks$HP09),
                             HP10 = -(all.peak.weeks$HP01 - all.peak.weeks$HP10),
                             HP11 = -(all.peak.weeks$HP01 - all.peak.weeks$HP11),
                             HP12 = -(all.peak.weeks$HP01 - all.peak.weeks$HP12))
rownames(peak_delay) <- rownames(peak_reduction)
knitr::kable(peak_delay, digits = 2, caption = "Delay in Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```


### % Reduction in Ill

```{r ill_3, warning=FALSE, message = FALSE}

r <- read.csv("./SympIllness_EPI1.csv")
r$scenario <- sub("_", "", r$scenario)

w <- spread(r[2:4], key = "scenario", value = "reduction")


knitr::kable(w, digits = 2, caption = "% Reduction in Burden (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

```{r ill_4, warning=FALSE, message=FALSE}
t <- rbind(rank(-w[1,2:12]),
          rank(-w[2,2:12]),
          rank(-w[3,2:12]),
          rank(-w[4,2:12]),
          rank(-w[5,2:12]),
          rank(-w[6,2:12]))

dt <- as.data.frame(t)
rownames(dt) <- w$team
colnames(dt) <- colnames(w)[2:12]

knitr::kable(dt, digits = 2, caption = "Rank Order of % Reduction in Burden (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

a <- read.csv("./SympIllness_age_EPI1.csv")
a$scenario <- sub("_", "", a$scenario)

w <- spread(a[2:5], key = "scenario", value = "reduction")

knitr::kable(w[2:13], digits = 2, caption = "% Reduction in Burden by Age (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  pack_rows(index = table(w$team))

```

```{r ill_5, warning=FALSE, message=FALSE}
# t <- as.data.frame(t(w[,2:12]))
# colnames(t) <- w$team
# t$mean <- rowMeans(t)
# t$team <- rownames(t)
# 
# o <- arrange(t, mean)
# rownames(o) <- o$team
# 
# ot <- as.data.frame(t(o[,1:7]))

# knitr::kable(ot[7,], digits = 2, caption = "Rank ordered Mean % Reduction in Burden (HP01)") %>%
#   kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative Hosps
```{r hosp_1, warning=FALSE, message = FALSE}
file.type = file.types[2]
tab_HP01 <- read_ill(scn = "HP01_")
all.peak.weeks <- data.frame(`HP01` = as.integer(gsub("Week", "", peak.week$V2)))
rownames(all.peak.weeks) <- peak.week$V1

# Cumulative Hosps
cml <- data.frame(`HP01` = tab_HP01$Cml)

# Peak Magnitude
peak <- data.frame(`HP01` = tab_HP01$Peak.Magnitude)

rownames(cml) <- tab_HP01$team
rownames(peak) <- tab_HP01$team

scenario <- "HP02_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP02 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP02 <- long$Cml

# Peak Magnitude
peak$HP02 = long$Peak.Magnitude

scenario <- "HP03_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP03 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP03 <- long$Cml

# Peak Magnitude
peak$HP03 = long$Peak.Magnitude

scenario <- "HP04_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP04 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP04 <- long$Cml

# Peak Magnitude
peak$HP04 = long$Peak.Magnitude

scenario <- "HP05_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP05 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP05 <- long$Cml

# Peak Magnitude
peak$HP05 = long$Peak.Magnitude

scenario <- "HP06_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP06 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP06 <- long$Cml

# Peak Magnitude
peak$HP06 = long$Peak.Magnitude

scenario <- "HP07_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP07 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP07 <- long$Cml

# Peak Magnitude
peak$HP07 = long$Peak.Magnitude

scenario <- "HP08_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP08 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP08 <- long$Cml

# Peak Magnitude
peak$HP08 = long$Peak.Magnitude

scenario <- "HP09_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP09 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP10 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP11 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP12 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude

knitr::kable(cml, digits = 2, caption = "Cumulative Hospitalizations per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak Hosps

```{r hosp_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak Hospitalizations per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_reduction <- data.frame(HP02 = (peak$HP01 - peak$HP02)/peak$HP01,
                             HP03 = (peak$HP01 - peak$HP03)/peak$HP01,
                             HP04 = (peak$HP01 - peak$HP04)/peak$HP01,
                             HP05 = (peak$HP01 - peak$HP05)/peak$HP01,
                             HP06 = (peak$HP01 - peak$HP06)/peak$HP01,
                             HP07 = (peak$HP01 - peak$HP07)/peak$HP01,
                             HP08 = (peak$HP01 - peak$HP08)/peak$HP01,
                             HP09 = (peak$HP01 - peak$HP09)/peak$HP01,
                             HP10 = (peak$HP01 - peak$HP10)/peak$HP01,
                             HP11 = (peak$HP01 - peak$HP11)/peak$HP01,
                             HP12 = (peak$HP01 - peak$HP12)/peak$HP01)
rownames(peak_reduction) <- rownames(peak)

knitr::kable(peak_reduction*100, digits = 2, caption = "% Reduction in Peak Hospitalizations per 100K (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


##Peak Week 
knitr::kable(all.peak.weeks, digits = 2, caption = "Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

##Peak Delay
peak_delay <- data.frame(HP02 = -(all.peak.weeks$HP01 - all.peak.weeks$HP02),
                             HP03 = -(all.peak.weeks$HP01 - all.peak.weeks$HP03),
                             HP04 = -(all.peak.weeks$HP01 - all.peak.weeks$HP04),
                             HP05 = -(all.peak.weeks$HP01 - all.peak.weeks$HP05),
                             HP06 = -(all.peak.weeks$HP01 - all.peak.weeks$HP06),
                             HP07 = -(all.peak.weeks$HP01 - all.peak.weeks$HP07),
                             HP08 = -(all.peak.weeks$HP01 - all.peak.weeks$HP08),
                             HP09 = -(all.peak.weeks$HP01 - all.peak.weeks$HP09),
                             HP10 = -(all.peak.weeks$HP01 - all.peak.weeks$HP10),
                             HP11 = -(all.peak.weeks$HP01 - all.peak.weeks$HP11),
                             HP12 = -(all.peak.weeks$HP01 - all.peak.weeks$HP12))
rownames(peak_delay) <- rownames(peak_reduction)
knitr::kable(peak_delay, digits = 2, caption = "Delay in Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```


### % Reduction in Hosps

```{r hosp_3, warning=FALSE, message = FALSE}

r <- read.csv("./Hospitalizations_EPI1.csv")
r$scenario <- sub("_", "", r$scenario)

w <- spread(r[2:4], key = "scenario", value = "reduction")


knitr::kable(w, digits = 2, caption = "% Reduction in Burden (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

```{r hosp_4, warning=FALSE, message=FALSE}
t <- rbind(rank(-w[1,2:12]),
          rank(-w[2,2:12]),
          rank(-w[3,2:12]),
          rank(-w[4,2:12]),
          rank(-w[5,2:12]),
          rank(-w[6,2:12]))

dt <- as.data.frame(t)
rownames(dt) <- w$team
colnames(dt) <- colnames(w)[2:12]

knitr::kable(dt, digits = 2, caption = "Rank Order of % Reduction in Burden (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


a <- read.csv("./Hospitalizations_age_EPI1.csv")
a$scenario <- sub("_", "", a$scenario)

w <- spread(a[2:5], key = "scenario", value = "reduction")

knitr::kable(w[2:13], digits = 2, caption = "% Reduction in Burden by Age (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  pack_rows(index = table(w$team))
```

```{r hosp_5, warning=FALSE, message=FALSE}
# t <- as.data.frame(t(w[,2:12]))
# colnames(t) <- w$team
# t$mean <- rowMeans(t)
# t$team <- rownames(t)
# 
# o <- arrange(t, mean)
# rownames(o) <- o$team
# 
# ot <- as.data.frame(t(o[,1:7]))

# knitr::kable(ot[7,], digits = 2, caption = "Rank ordered Mean % Reduction in Burden (HP01)") %>%
#   kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative Deaths
```{r death_1, warning=FALSE, message = FALSE}
file.type = file.types[3]
tab_HP01 <- read_ill(scn = "HP01_")
all.peak.weeks <- data.frame(`HP01` = as.integer(gsub("Week", "", peak.week$V2)))
rownames(all.peak.weeks) <- peak.week$V1

# Cumulative Deaths
cml <- data.frame(`HP01` = tab_HP01$Cml)

# Peak Magnitude
peak <- data.frame(`HP01` = tab_HP01$Peak.Magnitude)

rownames(cml) <- tab_HP01$team
rownames(peak) <- tab_HP01$team

scenario <- "HP02_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP02 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP02 <- long$Cml

# Peak Magnitude
peak$HP02 = long$Peak.Magnitude

scenario <- "HP03_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP03 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP03 <- long$Cml

# Peak Magnitude
peak$HP03 = long$Peak.Magnitude

scenario <- "HP04_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP04 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP04 <- long$Cml

# Peak Magnitude
peak$HP04 = long$Peak.Magnitude

scenario <- "HP05_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP05 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP05 <- long$Cml

# Peak Magnitude
peak$HP05 = long$Peak.Magnitude

scenario <- "HP06_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP06 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP06 <- long$Cml

# Peak Magnitude
peak$HP06 = long$Peak.Magnitude

scenario <- "HP07_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP07 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP07 <- long$Cml

# Peak Magnitude
peak$HP07 = long$Peak.Magnitude

scenario <- "HP08_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP08 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP08 <- long$Cml

# Peak Magnitude
peak$HP08 = long$Peak.Magnitude

scenario <- "HP09_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP09 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP10 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP11 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP12 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude

knitr::kable(cml, digits = 2, caption = "Cumulative Deaths per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak Deaths

```{r death_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak Deaths per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_reduction <- data.frame(HP02 = (peak$HP01 - peak$HP02)/peak$HP01,
                             HP03 = (peak$HP01 - peak$HP03)/peak$HP01,
                             HP04 = (peak$HP01 - peak$HP04)/peak$HP01,
                             HP05 = (peak$HP01 - peak$HP05)/peak$HP01,
                             HP06 = (peak$HP01 - peak$HP06)/peak$HP01,
                             HP07 = (peak$HP01 - peak$HP07)/peak$HP01,
                             HP08 = (peak$HP01 - peak$HP08)/peak$HP01,
                             HP09 = (peak$HP01 - peak$HP09)/peak$HP01,
                             HP10 = (peak$HP01 - peak$HP10)/peak$HP01,
                             HP11 = (peak$HP01 - peak$HP11)/peak$HP01,
                             HP12 = (peak$HP01 - peak$HP12)/peak$HP01)
rownames(peak_reduction) <- rownames(peak)

knitr::kable(peak_reduction*100, digits = 2, caption = "% Reduction in Peak Deaths per 100K (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


##Peak Week 
knitr::kable(all.peak.weeks, digits = 2, caption = "Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

##Peak Delay
peak_delay <- data.frame(HP02 = -(all.peak.weeks$HP01 - all.peak.weeks$HP02),
                             HP03 = -(all.peak.weeks$HP01 - all.peak.weeks$HP03),
                             HP04 = -(all.peak.weeks$HP01 - all.peak.weeks$HP04),
                             HP05 = -(all.peak.weeks$HP01 - all.peak.weeks$HP05),
                             HP06 = -(all.peak.weeks$HP01 - all.peak.weeks$HP06),
                             HP07 = -(all.peak.weeks$HP01 - all.peak.weeks$HP07),
                             HP08 = -(all.peak.weeks$HP01 - all.peak.weeks$HP08),
                             HP09 = -(all.peak.weeks$HP01 - all.peak.weeks$HP09),
                             HP10 = -(all.peak.weeks$HP01 - all.peak.weeks$HP10),
                             HP11 = -(all.peak.weeks$HP01 - all.peak.weeks$HP11),
                             HP12 = -(all.peak.weeks$HP01 - all.peak.weeks$HP12))
rownames(peak_delay) <- rownames(peak_reduction)
knitr::kable(peak_delay, digits = 2, caption = "Delay in Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### % Reduction in Deaths

```{r death_3, warning=FALSE, message = FALSE}

r <- read.csv("./Deaths_EPI1.csv")
r$scenario <- sub("_", "", r$scenario)

w <- spread(r[2:4], key = "scenario", value = "reduction")


knitr::kable(w, digits = 2, caption = "% Reduction in Burden (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

```{r death_4, warning=FALSE, message=FALSE}
t <- rbind(rank(-w[1,2:12]),
          rank(-w[2,2:12]),
          rank(-w[3,2:12]),
          rank(-w[4,2:12]),
          rank(-w[5,2:12]),
          rank(-w[6,2:12]))

dt <- as.data.frame(t)
rownames(dt) <- w$team
colnames(dt) <- colnames(w)[2:12]

knitr::kable(dt, digits = 2, caption = "Rank Order of % Reduction in Burden (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

a <- read.csv("./Deaths_age_EPI1.csv")
a$scenario <- sub("_", "", a$scenario)

w <- spread(a[2:5], key = "scenario", value = "reduction")

knitr::kable(w[2:13], digits = 2, caption = "% Reduction in Burden by Age (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  pack_rows(index = table(w$team))
```

```{r death_5, warning=FALSE, message=FALSE}
# t <- as.data.frame(t(w[,2:12]))
# colnames(t) <- w$team
# t$mean <- rowMeans(t)
# t$team <- rownames(t)
# 
# o <- arrange(t, mean)
# rownames(o) <- o$team
# 
# ot <- as.data.frame(t(o[,1:7]))

# knitr::kable(ot[7,], digits = 2, caption = "Rank ordered Mean % Reduction in Burden (HP01)") %>%
#   kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative % Antivirals
```{r av_1, warning=FALSE, message = FALSE}
file.type = file.types[4]
tab_HP08 <- read_ill(scn = "HP08_")

# Cumulative Hosps
cml <- data.frame(`HP08` = tab_HP08$Cml)

# Peak Magnitude
peak <- data.frame(`HP08` = tab_HP08$Peak.Magnitude)

rownames(cml) <- tab_HP08$team
rownames(peak) <- tab_HP08$team

scenario <- "HP09_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP09 <- long$Cml

# Peak Magnitude
peak$HP09 = long$Peak.Magnitude

scenario <- "HP10_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP10 <- long$Cml

# Peak Magnitude
peak$HP10 = long$Peak.Magnitude

scenario <- "HP11_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP11 <- long$Cml

# Peak Magnitude
peak$HP11 = long$Peak.Magnitude

scenario <- "HP12_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 
cml$HP12 <- long$Cml

# Peak Magnitude
peak$HP12 = long$Peak.Magnitude

knitr::kable(cml, digits = 2, caption = "Cumulative % Antivirals") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak % Antivirals

```{r av_2, warning=FALSE, message = FALSE}

knitr::kable(peak, digits = 2, caption = "Peak % Antivirals") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```