---
title: "Summary of EPI2 Scenarios"
author: "Pragati Prasad"
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## {.tabset}


### Scenario Key
HP13 - BASE:  R0 of 1.7 and “2009-like” severity multiplied by 2 for all age groups except 65+, which remains the same as 2009   
HP14 - VX1: “Early”: Vaccine available 100 days after September 1    
HP15 - VX2: “Normal”: Vaccine available 150 days after September 1    
HP16 - SC1: Weekly Symptomatic Prevalence > 1% trigger, early (VX1) vaccine availability reopening   
HP17 - SC2: Close on October 28, early (VX1) vaccine availability reopening    
HP18 - SC3: Weekly Symptomatic Prevalence > 1% trigger, normal (VX2) vaccine availability reopening   
HP19 - SC4: Close on October 28, normal (VX2) vaccine availability reopening    
HP20 - AV: Antivirals   
HP21 - VX1 + SC1 + AV  
HP22 - VX1 + SC2 + AV  
HP23 - VX2 + SC3 + AV  
HP24 - VX2 + SC4 + AV  

```{r setup_1, warning=FALSE, message = FALSE}

library(ggsci)
library(reshape)
library(dplyr)
library(gridExtra)
library(ggplot2) 
library(egg)
library(plyr)
library(tidyr)
library(knitr)
library(kableExtra)
library(scales)

path <- "../model-forecasts/"

team.folder <- c("Columbia/COL/EPI2/", "Northeastern/EPI2/", "UTAustin/", "UVirginia/", "Imperial/", "Columbia/COL2/EPI2/")
team.abbrev <- c("COL", "NEU", "UTA", "UVA", "IMP", "COL2")
file.types <- c("SymIllness", "Hosp", "Deaths", "AntiviralTX")

file.type <- file.types[1]
scn = "HP13_"
read_ill <- function(scn){
  
  cols <- c("sm.mean")

  s <- read.csv(paste0(path,team.folder[1],scn,file.type,"_",team.abbrev[1],".csv"))
  symillness <- data.frame(c(s[which(s$Agegroup == "Overall" &
                                       s$Bin_cml %in% cols),],
                             `team` = team.abbrev[1]))
  
  df_sub <- select(symillness, contains("Week"))
  peak.week<- c(team.abbrev[1], colnames(df_sub)[which.max(df_sub)])
  
  for(i in 2:6){
    
    if(i == 4){
      scn = gsub("HP", "HP_", scn)
    }
    if(i == 5){
      scn = gsub("_", "", scn)
    }
    if(i == 6){
      scn = paste0(scn, "_")
    }
    
    f =  paste0(path,team.folder[i],scn,file.type,"_",team.abbrev[i],".csv")
    if(i == 5){
      f =  paste0(path,team.folder[i],scn,file.type,team.abbrev[i],".csv")
      if(file.type == "Deaths"){
        f =  paste0(path,team.folder[i],scn,"Death",team.abbrev[i],".csv")
      }
    }

    if(file.exists(f)){
      s <- read.csv(f)
      if(ncol(s) > 58){
        s <- s[-1]
      }
      u <- data.frame(c(s[which(s$Agegroup == "Overall" & 
                                  s$Bin_cml %in% cols),],`team` = team.abbrev[i]))
      symillness <- rbind.fill(symillness, u)
      df_sub <- select(u, contains("Week"))
      peak.week <- rbind(peak.week, c(team.abbrev[i], colnames(df_sub)[which.max(df_sub)]))
    }
    
  }
  symillness$Peak.Magnitude[which(is.na(symillness$Peak.Magnitude))] <-
    symillness$PeakMagnitude[which(is.na(symillness$Peak.Magnitude))]
  
  symillness$Bin[which(symillness$Bin_cml == "Peak")] <- "sm.peak"
  cml <- symillness[c("Cml", "team", "Bin", "Peak.Magnitude")]
  peak.week <<- as.data.frame(peak.week)
  return(cml)
}

tab_HP13 <- read_ill(scn = "HP13_")
all.peak.weeks <- data.frame(`HP13` = as.integer(gsub("Week", "", peak.week$V2)))
rownames(all.peak.weeks) <- peak.week$V1

# Cumulative % Ill
cml <- data.frame(`HP13` = tab_HP13$Cml)

# Peak Magnitude
peak <- data.frame(`HP13` = tab_HP13$Peak.Magnitude)

rownames(cml) <- tab_HP13$team
rownames(peak) <- tab_HP13$team

scenario <- "HP14_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP14 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP14 <- long$Cml

# Peak Magnitude
peak$HP14 = long$Peak.Magnitude

scenario <- "HP15_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP15 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP15 <- long$Cml

# Peak Magnitude
peak$HP15 = long$Peak.Magnitude

scenario <- "HP16_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP16 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP16 <- long$Cml

# Peak Magnitude
peak$HP16 = long$Peak.Magnitude

library(DataCombine)
scenario <- "HP17_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP17 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill

cml$HP17 <- long$Cml

# Peak Magnitude
peak$HP17 = long$Peak.Magnitude

scenario <- "HP18_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP18 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill

cml$HP18 <- long$Cml

# Peak Magnitude
peak$HP18 = long$Peak.Magnitude

scenario <- "HP19_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP19 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill

cml$HP19 <- long$Cml

# Peak Magnitude
peak$HP19 = long$Peak.Magnitude

scenario <- "HP20_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP20 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill

cml$HP20 <- long$Cml

# Peak Magnitude
peak$HP20 = long$Peak.Magnitude

scenario <- "HP21_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP21 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill

cml$HP21 <- long$Cml

# Peak Magnitude
peak$HP21 = long$Peak.Magnitude

scenario <- "HP22_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP22 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill

cml$HP22 <- long$Cml

# Peak Magnitude
peak$HP22 = long$Peak.Magnitude

scenario <- "HP23_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP23 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill

cml$HP23 <- long$Cml

# Peak Magnitude
peak$HP23 = long$Peak.Magnitude

scenario <- "HP24_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP24 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative % Ill
cml$HP24 <- long$Cml

# Peak Magnitude
peak$HP24 = long$Peak.Magnitude
```


### Cumulative % Ill

```{r ill_1, warning=FALSE, message = FALSE}

library(hablar)
cml <- cml %>% convert(num(c(HP17, HP18, HP19, HP20, HP21, HP22, HP23, HP24)))
rownames(cml) <- tab_HP13$team

knitr::kable(cml, digits = 2, caption = "Cumulative % Ill") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```


### Peak % Ill

```{r ill_2, warning=FALSE, message = FALSE}

peak <- peak %>% convert(num(c(HP17, HP18, HP19, HP20, HP21, HP22, HP23, HP24)))
rownames(peak) <- tab_HP13$team

knitr::kable(peak, digits = 2, caption = "Peak Magnitude Ill") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_reduction <- data.frame(HP14 = (peak$HP13 - peak$HP14)/peak$HP13,
                             HP15 = (peak$HP13 - peak$HP15)/peak$HP13,
                             HP16 = (peak$HP13 - peak$HP16)/peak$HP13,
                             HP17 = (peak$HP13 - peak$HP17)/peak$HP13,
                             HP18 = (peak$HP13 - peak$HP18)/peak$HP13,
                             HP19 = (peak$HP13 - peak$HP19)/peak$HP13,
                             HP20 = (peak$HP13 - peak$HP20)/peak$HP13,
                             HP21 = (peak$HP13 - peak$HP21)/peak$HP13,
                             HP22 = (peak$HP13 - peak$HP22)/peak$HP13,
                             HP23 = (peak$HP13 - peak$HP23)/peak$HP13,
                             HP24 = (peak$HP13 - peak$HP24)/peak$HP13)
rownames(peak_reduction) <- rownames(peak)

knitr::kable(peak_reduction*100, digits = 2, caption = "% Reduction in Peak Magnitude Ill (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

##Peak Week 
knitr::kable(all.peak.weeks, digits = 2, caption = "Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


peak_delay <- data.frame(HP14 = -(all.peak.weeks$HP13 - all.peak.weeks$HP14),
                             HP15 = -(all.peak.weeks$HP13 - all.peak.weeks$HP15),
                             HP16 = -(all.peak.weeks$HP13 - all.peak.weeks$HP16),
                             HP17 = -(all.peak.weeks$HP13 - all.peak.weeks$HP17),
                             HP18 = -(all.peak.weeks$HP13 - all.peak.weeks$HP18),
                             HP19 = -(all.peak.weeks$HP13 - all.peak.weeks$HP19),
                             HP20 = -(all.peak.weeks$HP13 - all.peak.weeks$HP20),
                             HP21 = -(all.peak.weeks$HP13 - all.peak.weeks$HP21),
                             HP22 = -(all.peak.weeks$HP13 - all.peak.weeks$HP22),
                             HP23 = -(all.peak.weeks$HP13 - all.peak.weeks$HP23),
                             HP24 = -(all.peak.weeks$HP13 - all.peak.weeks$HP24))
rownames(peak_delay) <- rownames(peak)

knitr::kable(peak_delay, digits = 2, caption = "Delay in peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```


### % Reduction in Ill

```{r ill_3, warning=FALSE, message = FALSE}

r <- read.csv("./SympIllness_EPI2.csv")
r$scenario <- sub("_", "", r$scenario)

w <- spread(r[2:4], key = "scenario", value = "reduction")


knitr::kable(w, digits = 2, caption = "% Reduction in Burden (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

```{r ill_4, warning=FALSE, message=FALSE}
t <- rbind(rank(-w[1,2:12]),
          rank(-w[2,2:12]),
          rank(-w[3,2:12]),
          rank(-w[4,2:12]),
          rank(-w[5,2:12]),
          rank(-w[6,2:12]))

dt <- as.data.frame(t)
rownames(dt) <- w$team
colnames(dt) <- colnames(w)[2:12]

knitr::kable(dt, digits = 1, caption = "Rank Order of % Reduction in Burden (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

a <- read.csv("./SympIllness_age_EPI2.csv")
a$scenario <- sub("_", "", a$scenario)

w <- spread(a[2:5], key = "scenario", value = "reduction")

knitr::kable(w[2:13], digits = 2, caption = "% Reduction in Burden by Age (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  pack_rows(index = table(w$team))

```

```{r ill_5, warning=FALSE, message=FALSE}
# t <- as.data.frame(t(w[,2:12]))
# colnames(t) <- w$team
# t$mean <- rowMeans(t)
# t$team <- rownames(t)
# 
# o <- arrange(t, mean)
# rownames(o) <- o$team
# 
# ot <- as.data.frame(t(o[,1:7]))
# 
# knitr::kable(ot[7,], digits = 2, caption = "Rank ordered Mean % Reduction in Burden (HP13)") %>%
#   kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative Hosps
```{r hosp_1, warning=FALSE, message = FALSE}
file.type = file.types[2]
tab_HP13 <- read_ill(scn = "HP13_")
all.peak.weeks <- data.frame(`HP13` = as.integer(gsub("Week", "", peak.week$V2)))
rownames(all.peak.weeks) <- peak.week$V1

# Cumulative Hosps
cml <- data.frame(`HP13` = tab_HP13$Cml)

# Peak Magnitude
peak <- data.frame(`HP13` = tab_HP13$Peak.Magnitude)

rownames(cml) <- tab_HP13$team
rownames(peak) <- tab_HP13$team

scenario <- "HP14_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP14 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP14 <- long$Cml

# Peak Magnitude
peak$HP14 = long$Peak.Magnitude

scenario <- "HP15_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP15 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP15 <- long$Cml

# Peak Magnitude
peak$HP15 = long$Peak.Magnitude

scenario <- "HP16_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP16 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP16 <- long$Cml

# Peak Magnitude
peak$HP16 = long$Peak.Magnitude

library(DataCombine)
scenario <- "HP17_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP17 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps

cml$HP17 <- long$Cml

# Peak Magnitude
peak$HP17 = long$Peak.Magnitude

scenario <- "HP18_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP18 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps

cml$HP18 <- long$Cml

# Peak Magnitude
peak$HP18 = long$Peak.Magnitude

scenario <- "HP19_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP19 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps

cml$HP19 <- long$Cml

# Peak Magnitude
peak$HP19 = long$Peak.Magnitude

scenario <- "HP20_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP20 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps

cml$HP20 <- long$Cml

# Peak Magnitude
peak$HP20 = long$Peak.Magnitude

scenario <- "HP21_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP21 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps

cml$HP21 <- long$Cml

# Peak Magnitude
peak$HP21 = long$Peak.Magnitude

scenario <- "HP22_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP22 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps

cml$HP22 <- long$Cml

# Peak Magnitude
peak$HP22 = long$Peak.Magnitude

scenario <- "HP23_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP23 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps

cml$HP23 <- long$Cml

# Peak Magnitude
peak$HP23 = long$Peak.Magnitude

scenario <- "HP24_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP24 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Hosps
cml$HP24 <- long$Cml

# Peak Magnitude
peak$HP24 = long$Peak.Magnitude

# cml <- cml %>% convert(num(c(HP17, HP18, HP19, HP20, HP21, HP22, HP23, HP24)))
# rownames(cml) <- tab_HP13$team

knitr::kable(cml, digits = 2, caption = "Cumulative Hospitalizations per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak Hosps

```{r hosp_2, warning=FALSE, message = FALSE}

peak <- peak %>% convert(num(c(HP17, HP18, HP19, HP20, HP21, HP22, HP23, HP24)))
rownames(peak) <- tab_HP13$team

knitr::kable(peak, digits = 2, caption = "Peak Hospitalizations per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_reduction <- data.frame(HP14 = (peak$HP13 - peak$HP14)/peak$HP13,
                             HP15 = (peak$HP13 - peak$HP15)/peak$HP13,
                             HP16 = (peak$HP13 - peak$HP16)/peak$HP13,
                             HP17 = (peak$HP13 - peak$HP17)/peak$HP13,
                             HP18 = (peak$HP13 - peak$HP18)/peak$HP13,
                             HP19 = (peak$HP13 - peak$HP19)/peak$HP13,
                             HP20 = (peak$HP13 - peak$HP20)/peak$HP13,
                             HP21 = (peak$HP13 - peak$HP21)/peak$HP13,
                             HP22 = (peak$HP13 - peak$HP22)/peak$HP13,
                             HP23 = (peak$HP13 - peak$HP23)/peak$HP13,
                             HP24 = (peak$HP13 - peak$HP24)/peak$HP13)
rownames(peak_reduction) <- rownames(peak)

knitr::kable(peak_reduction*100, digits = 2, caption = "% Reduction in Peak Hospitalizations per 100K (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

##Peak Week 
knitr::kable(all.peak.weeks, digits = 2, caption = "Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_delay <- data.frame(HP14 = -(all.peak.weeks$HP13 - all.peak.weeks$HP14),
                             HP15 = -(all.peak.weeks$HP13 - all.peak.weeks$HP15),
                             HP16 = -(all.peak.weeks$HP13 - all.peak.weeks$HP16),
                             HP17 = -(all.peak.weeks$HP13 - all.peak.weeks$HP17),
                             HP18 = -(all.peak.weeks$HP13 - all.peak.weeks$HP18),
                             HP19 = -(all.peak.weeks$HP13 - all.peak.weeks$HP19),
                             HP20 = -(all.peak.weeks$HP13 - all.peak.weeks$HP20),
                             HP21 = -(all.peak.weeks$HP13 - all.peak.weeks$HP21),
                             HP22 = -(all.peak.weeks$HP13 - all.peak.weeks$HP22),
                             HP23 = -(all.peak.weeks$HP13 - all.peak.weeks$HP23),
                             HP24 = -(all.peak.weeks$HP13 - all.peak.weeks$HP24))
rownames(peak_delay) <- rownames(peak)

knitr::kable(peak_delay, digits = 2, caption = "Delay in peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### % Reduction in Hosps

```{r hosp_3, warning=FALSE, message = FALSE}

r <- read.csv("./Hospitalizations_EPI2.csv")
r$scenario <- sub("_", "", r$scenario)

w <- spread(r[2:4], key = "scenario", value = "reduction")


knitr::kable(w, digits = 2, caption = "% Reduction in Burden (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

```{r hosp_4, warning=FALSE, message=FALSE}
t <- rbind(rank(-w[1,2:12]),
          rank(-w[2,2:12]),
          rank(-w[3,2:12]),
          rank(-w[4,2:12]),
          rank(-w[5,2:12]),
          rank(-w[6,2:12]))

dt <- as.data.frame(t)
rownames(dt) <- w$team
colnames(dt) <- colnames(w)[2:12]

knitr::kable(dt, digits = 1, caption = "Rank Order of % Reduction in Burden (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

a <- read.csv("./Hospitalizations_age_EPI2.csv")
a$scenario <- sub("_", "", a$scenario)

w <- spread(a[2:5], key = "scenario", value = "reduction")

knitr::kable(w[2:13], digits = 2, caption = "% Reduction in Burden by Age (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  pack_rows(index = table(w$team))
```

```{r hosp_5, warning=FALSE, message=FALSE}
# t <- as.data.frame(t(w[,2:12]))
# colnames(t) <- w$team
# t$mean <- rowMeans(t)
# t$team <- rownames(t)
# 
# o <- arrange(t, mean)
# rownames(o) <- o$team
# 
# ot <- as.data.frame(t(o[,1:7]))
# 
# knitr::kable(ot[7,], digits = 2, caption = "Rank ordered Mean % Reduction in Burden (HP13)") %>%
#   kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative Deaths
```{r death_1, warning=FALSE, message = FALSE}
file.type = file.types[3]
tab_HP13 <- read_ill(scn = "HP13_")
all.peak.weeks <- data.frame(`HP13` = as.integer(gsub("Week", "", peak.week$V2)))
rownames(all.peak.weeks) <- peak.week$V1

# Cumulative Deaths
cml <- data.frame(`HP13` = tab_HP13$Cml)

# Peak Magnitude
peak <- data.frame(`HP13` = tab_HP13$Peak.Magnitude)

rownames(cml) <- tab_HP13$team
rownames(peak) <- tab_HP13$team

scenario <- "HP14_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP14 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP14 <- long$Cml

# Peak Magnitude
peak$HP14 = long$Peak.Magnitude

scenario <- "HP15_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP15 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP15 <- long$Cml

# Peak Magnitude
peak$HP15 = long$Peak.Magnitude

scenario <- "HP16_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP16 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP16 <- long$Cml

# Peak Magnitude
peak$HP16 = long$Peak.Magnitude

library(DataCombine)
scenario <- "HP17_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP17 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths

cml$HP17 <- long$Cml

# Peak Magnitude
peak$HP17 = long$Peak.Magnitude

scenario <- "HP18_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP18 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths

cml$HP18 <- long$Cml

# Peak Magnitude
peak$HP18 = long$Peak.Magnitude

scenario <- "HP19_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP19 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths

cml$HP19 <- long$Cml

# Peak Magnitude
peak$HP19 = long$Peak.Magnitude

scenario <- "HP20_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP20 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths

cml$HP20 <- long$Cml

# Peak Magnitude
peak$HP20 = long$Peak.Magnitude

scenario <- "HP21_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP21 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths

cml$HP21 <- long$Cml

# Peak Magnitude
peak$HP21 = long$Peak.Magnitude

scenario <- "HP22_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP22 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths

cml$HP22 <- long$Cml

# Peak Magnitude
peak$HP22 = long$Peak.Magnitude

scenario <- "HP23_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP23 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths

cml$HP23 <- long$Cml

# Peak Magnitude
peak$HP23 = long$Peak.Magnitude

scenario <- "HP24_"
long <- read_ill(scn = scenario)
all.peak.weeks$HP24 = as.integer(gsub("Week", "", peak.week$V2))

# Cumulative Deaths
cml$HP24 <- long$Cml

# Peak Magnitude
peak$HP24 = long$Peak.Magnitude

# cml <- cml %>% convert(num(c(HP17, HP18, HP19, HP20, HP21, HP22, HP23, HP24)))
# rownames(cml) <- tab_HP13$team

knitr::kable(cml, digits = 2, caption = "Cumulative Deaths per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak Deaths

```{r death_2, warning=FALSE, message = FALSE}

peak <- peak %>% convert(num(c(HP17, HP18, HP19, HP20, HP21, HP22, HP23, HP24)))
rownames(peak) <- tab_HP13$team

knitr::kable(peak, digits = 2, caption = "Peak Deaths per 100K") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_reduction <- data.frame(HP14 = (peak$HP13 - peak$HP14)/peak$HP13,
                             HP15 = (peak$HP13 - peak$HP15)/peak$HP13,
                             HP16 = (peak$HP13 - peak$HP16)/peak$HP13,
                             HP17 = (peak$HP13 - peak$HP17)/peak$HP13,
                             HP18 = (peak$HP13 - peak$HP18)/peak$HP13,
                             HP19 = (peak$HP13 - peak$HP19)/peak$HP13,
                             HP20 = (peak$HP13 - peak$HP20)/peak$HP13,
                             HP21 = (peak$HP13 - peak$HP21)/peak$HP13,
                             HP22 = (peak$HP13 - peak$HP22)/peak$HP13,
                             HP23 = (peak$HP13 - peak$HP23)/peak$HP13,
                             HP24 = (peak$HP13 - peak$HP24)/peak$HP13)
rownames(peak_reduction) <- rownames(peak)

knitr::kable(peak_reduction*100, digits = 2, caption = "% Reduction in Peak Deaths per 100K (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


##Peak Week 
knitr::kable(all.peak.weeks, digits = 2, caption = "Peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

peak_delay <- data.frame(HP14 = -(all.peak.weeks$HP13 - all.peak.weeks$HP14),
                             HP15 = -(all.peak.weeks$HP13 - all.peak.weeks$HP15),
                             HP16 = -(all.peak.weeks$HP13 - all.peak.weeks$HP16),
                             HP17 = -(all.peak.weeks$HP13 - all.peak.weeks$HP17),
                             HP18 = -(all.peak.weeks$HP13 - all.peak.weeks$HP18),
                             HP19 = -(all.peak.weeks$HP13 - all.peak.weeks$HP19),
                             HP20 = -(all.peak.weeks$HP13 - all.peak.weeks$HP20),
                             HP21 = -(all.peak.weeks$HP13 - all.peak.weeks$HP21),
                             HP22 = -(all.peak.weeks$HP13 - all.peak.weeks$HP22),
                             HP23 = -(all.peak.weeks$HP13 - all.peak.weeks$HP23),
                             HP24 = -(all.peak.weeks$HP13 - all.peak.weeks$HP24))
rownames(peak_delay) <- rownames(peak)

knitr::kable(peak_delay, digits = 2, caption = "Delay in peak Week") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### % Reduction in Deaths

```{r death_3, warning=FALSE, message = FALSE}

r <- read.csv("./Deaths_EPI2.csv")
r$scenario <- sub("_", "", r$scenario)

w <- spread(r[2:4], key = "scenario", value = "reduction")


knitr::kable(w, digits = 2, caption = "% Reduction in Burden (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

```{r death_4, warning=FALSE, message=FALSE}
t <- rbind(rank(-w[1,2:12]),
          rank(-w[2,2:12]),
          rank(-w[3,2:12]),
          rank(-w[4,2:12]),
          rank(-w[5,2:12]),
          rank(-w[6,2:12]))

dt <- as.data.frame(t)
rownames(dt) <- w$team
colnames(dt) <- colnames(w)[2:12]

knitr::kable(dt, digits = 1, caption = "Rank Order of % Reduction in Burden (HP13)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


a <- read.csv("./Deaths_age_EPI2.csv")
a$scenario <- sub("_", "", a$scenario)

w <- spread(a[2:5], key = "scenario", value = "reduction")

knitr::kable(w[2:13], digits = 2, caption = "% Reduction in Burden by Age (HP01)") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  pack_rows(index = table(w$team))
```

```{r death_5, warning=FALSE, message=FALSE}
# t <- as.data.frame(t(w[,2:12]))
# colnames(t) <- w$team
# t$mean <- rowMeans(t)
# t$team <- rownames(t)
# 
# o <- arrange(t, mean)
# rownames(o) <- o$team
# 
# ot <- as.data.frame(t(o[,1:7]))
# 
# knitr::kable(ot[7,], digits = 2, caption = "Rank ordered Mean % Reduction in Burden (HP13)") %>%
#   kable_styling(bootstrap_options = c("striped", "hover"))

```

### Cumulative % Antivirals
```{r av_1, warning=FALSE, message = FALSE}
file.type = file.types[4]
tab_HP20 <- read_ill(scn = "HP20_")

# Cumulative AV
tab_HP20$team <- as.character(tab_HP20$team)
cml <- data.frame(`HP20` = tab_HP20$Cml)

# Peak Magnitude
peak <- data.frame(`HP20` = tab_HP20$Peak.Magnitude)

rownames(cml) <- tab_HP20$team
rownames(peak) <- tab_HP20$team

scenario <- "HP21_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 

cml$HP21 <- long$Cml

# Peak Magnitude
peak$HP21 = long$Peak.Magnitude

scenario <- "HP22_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 

cml$HP22 <- long$Cml

# Peak Magnitude
peak$HP22 = long$Peak.Magnitude

scenario <- "HP23_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 

cml$HP23 <- long$Cml

# Peak Magnitude
peak$HP23 = long$Peak.Magnitude

scenario <- "HP24_"
long <- read_ill(scn = scenario)

# Cumulative Antivirals 

cml$HP24 <- long$Cml

# Peak Magnitude
peak$HP24 = long$Peak.Magnitude

cml <- cml %>% convert(num(c( HP20, HP21, HP22, HP23, HP24)))
rownames(cml) <- tab_HP20$team

knitr::kable(cml, digits = 2, caption = "Cumulative % Antivirals") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Peak % Antivirals

```{r av_2, warning=FALSE, message = FALSE}

peak <- peak %>% convert(num(c(HP20, HP21, HP22, HP23, HP24)))
rownames(peak) <- tab_HP20$team

knitr::kable(peak, digits = 2, caption = "Peak % Antivirals") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```